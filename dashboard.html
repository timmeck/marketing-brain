<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketing Brain â€” Dashboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#04060e;--bg2:rgba(10,12,24,.7);--bg3:rgba(20,24,50,.6);--bg4:rgba(30,35,70,.5);
    --glass:rgba(15,18,40,.55);--glass-border:rgba(100,120,255,.12);--glass-hover:rgba(100,120,255,.2);
    --text:#e8eaf6;--text2:#8b8fb0;--text3:#4a4d6e;
    --blue:#5b9cff;--red:#ff5577;--green:#3dffa0;
    --purple:#b47aff;--orange:#ffb347;--cyan:#47e5ff;
    --accent:linear-gradient(135deg,#b47aff,#5b9cff,#47e5ff);
    --radius:16px;--radius-sm:10px;
  }
  html{scroll-behavior:smooth}
  body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}

  /* Neural canvas background */
  #neural-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}

  /* Ambient glow orbs */
  .orb{position:fixed;border-radius:50%;filter:blur(120px);opacity:.12;pointer-events:none;z-index:0}
  .orb-1{width:600px;height:600px;background:var(--purple);top:-200px;left:-100px;animation:orb-float 20s ease-in-out infinite}
  .orb-2{width:500px;height:500px;background:var(--blue);bottom:-150px;right:-100px;animation:orb-float 25s ease-in-out infinite reverse}
  .orb-3{width:400px;height:400px;background:var(--cyan);top:40%;left:50%;animation:orb-float 18s ease-in-out infinite 5s}
  @keyframes orb-float{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(60px,-40px) scale(1.1)}66%{transform:translate(-40px,60px) scale(.9)}}

  .container{max-width:1400px;margin:0 auto;padding:0 28px;position:relative;z-index:1}

  /* Reveal animations */
  .reveal{opacity:0;transform:translateY(30px);transition:opacity .6s ease,transform .6s ease}
  .reveal.visible{opacity:1;transform:translateY(0)}
  .reveal-delay-1{transition-delay:.1s}.reveal-delay-2{transition-delay:.2s}
  .reveal-delay-3{transition-delay:.3s}.reveal-delay-4{transition-delay:.4s}
  .reveal-delay-5{transition-delay:.5s}

  section{margin-bottom:56px}

  /* Header */
  header{padding:60px 0 24px;text-align:center;position:relative}
  .logo{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:12px}
  .logo-icon{
    width:68px;height:68px;border-radius:18px;
    background:linear-gradient(135deg,var(--purple),var(--blue),var(--cyan));
    display:flex;align-items:center;justify-content:center;font-size:32px;
    box-shadow:0 0 60px rgba(170,102,255,.35),0 0 120px rgba(90,150,255,.15);
    animation:icon-breathe 4s ease-in-out infinite;
    position:relative;
  }
  .logo-icon::after{
    content:'';position:absolute;inset:-3px;border-radius:20px;
    background:linear-gradient(135deg,var(--purple),var(--cyan));
    opacity:.4;filter:blur(8px);z-index:-1;animation:icon-breathe 4s ease-in-out infinite reverse;
  }
  @keyframes icon-breathe{0%,100%{box-shadow:0 0 60px rgba(170,102,255,.35),0 0 120px rgba(90,150,255,.15)}50%{box-shadow:0 0 80px rgba(170,102,255,.5),0 0 160px rgba(90,150,255,.25)}}
  .logo h1{font-size:2.8rem;font-weight:900;letter-spacing:-1px;background:linear-gradient(135deg,#fff 0%,var(--blue) 50%,var(--purple) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .tagline{color:var(--text2);font-size:1.05rem;font-weight:300;letter-spacing:.5px}

  /* Activity indicator */
  .activity{display:inline-flex;align-items:center;gap:10px;margin-top:16px;padding:8px 20px;border-radius:30px;background:var(--glass);border:1px solid var(--glass-border);backdrop-filter:blur(20px)}
  .activity-dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 12px var(--green);animation:pulse-dot 2s ease-in-out infinite}
  @keyframes pulse-dot{0%,100%{opacity:1;box-shadow:0 0 12px var(--green)}50%{opacity:.5;box-shadow:0 0 20px var(--green)}}
  .activity-text{font-size:.8rem;color:var(--text2);font-weight:500}
  .activity-bar{width:80px;height:4px;border-radius:2px;background:var(--bg4);overflow:hidden}
  .activity-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--green),var(--cyan));transition:width 1.5s ease}

  /* Nav */
  nav{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;padding:20px 0;margin-bottom:40px}
  nav a{
    color:var(--text2);text-decoration:none;padding:8px 18px;border-radius:24px;font-size:.85rem;font-weight:500;
    transition:all .3s ease;border:1px solid transparent;backdrop-filter:blur(10px);
  }
  nav a:hover{color:var(--text);background:var(--glass);border-color:var(--glass-border);transform:translateY(-1px)}
  nav a.research{
    background:var(--glass);color:var(--cyan);border-color:rgba(71,229,255,.25);font-weight:600;
    box-shadow:0 0 20px rgba(71,229,255,.1);animation:nav-glow 3s ease-in-out infinite alternate;
  }
  @keyframes nav-glow{0%{box-shadow:0 0 20px rgba(71,229,255,.1)}100%{box-shadow:0 0 35px rgba(71,229,255,.2)}}

  /* Stats */
  .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:18px}
  .stat-card{
    background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);
    padding:28px 22px;text-align:center;position:relative;overflow:hidden;
    transition:all .35s ease;backdrop-filter:blur(20px);
  }
  .stat-card:hover{transform:translateY(-4px);border-color:var(--glass-hover);box-shadow:0 20px 60px rgba(0,0,0,.3)}
  .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
  .stat-card::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at 50% 0%,rgba(255,255,255,.03),transparent 70%);pointer-events:none}
  .stat-card.blue::before{background:linear-gradient(90deg,transparent,var(--blue),transparent)}
  .stat-card.purple::before{background:linear-gradient(90deg,transparent,var(--purple),transparent)}
  .stat-card.red::before{background:linear-gradient(90deg,transparent,var(--red),transparent)}
  .stat-card.green::before{background:linear-gradient(90deg,transparent,var(--green),transparent)}
  .stat-card.orange::before{background:linear-gradient(90deg,transparent,var(--orange),transparent)}
  .stat-card.cyan::before{background:linear-gradient(90deg,transparent,var(--cyan),transparent)}
  .stat-number{font-size:2.6rem;font-weight:900;letter-spacing:-2px}
  .stat-card.blue .stat-number{color:var(--blue)}.stat-card.purple .stat-number{color:var(--purple)}
  .stat-card.red .stat-number{color:var(--red)}.stat-card.green .stat-number{color:var(--green)}
  .stat-card.orange .stat-number{color:var(--orange)}.stat-card.cyan .stat-number{color:var(--cyan)}
  .stat-label{color:var(--text2);font-size:.82rem;margin-top:6px;font-weight:500;letter-spacing:.3px;text-transform:uppercase}

  /* Section titles */
  .section-title{font-size:1.5rem;font-weight:700;margin-bottom:24px;display:flex;align-items:center;gap:12px}
  .section-title .icon{font-size:1.2rem;width:38px;height:38px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}

  /* Platform chart */
  .platform-chart{max-width:650px}
  .platform-row{display:flex;align-items:center;gap:14px;margin-bottom:10px}
  .platform-name{width:100px;text-align:right;font-size:.85rem;color:var(--text2);font-weight:500}
  .platform-bar-bg{flex:1;height:28px;background:var(--bg3);border-radius:6px;overflow:hidden;border:1px solid var(--glass-border)}
  .platform-bar{height:100%;border-radius:6px;width:0;transition:width 1.2s cubic-bezier(.22,1,.36,1)}
  .platform-bar.x-bar{background:linear-gradient(90deg,#1da1f2,#47e5ff)}
  .platform-bar.reddit-bar{background:linear-gradient(90deg,#ff4500,#ffb347)}
  .platform-bar.linkedin-bar{background:linear-gradient(90deg,#0077b5,#5b9cff)}
  .platform-bar.bluesky-bar{background:linear-gradient(90deg,#0085ff,#b47aff)}
  .platform-bar.default-bar{background:var(--accent)}
  .platform-count{width:50px;font-size:.85rem;color:var(--text2);font-weight:600}

  /* Top posts */
  .post-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:14px}
  .post-card{
    background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);
    padding:18px;border-left:3px solid var(--text3);transition:all .25s ease;backdrop-filter:blur(20px);
  }
  .post-card:hover{transform:translateX(6px);border-color:var(--glass-hover);box-shadow:0 8px 30px rgba(0,0,0,.2)}
  .post-card.x{border-left-color:#1da1f2}.post-card.reddit{border-left-color:#ff4500}
  .post-card.linkedin{border-left-color:#0077b5}.post-card.bluesky{border-left-color:#0085ff}
  .post-meta{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
  .post-platform{font-size:.72rem;padding:3px 10px;border-radius:12px;text-transform:uppercase;font-weight:700;letter-spacing:.5px}
  .post-platform.x{background:rgba(29,161,242,.15);color:#1da1f2;border:1px solid rgba(29,161,242,.25)}
  .post-platform.reddit{background:rgba(255,69,0,.15);color:#ff4500;border:1px solid rgba(255,69,0,.25)}
  .post-platform.linkedin{background:rgba(0,119,181,.15);color:#0077b5;border:1px solid rgba(0,119,181,.25)}
  .post-platform.bluesky{background:rgba(0,133,255,.15);color:#0085ff;border:1px solid rgba(0,133,255,.25)}
  .post-card p{color:var(--text2);font-size:.85rem;line-height:1.5}
  .post-engagement{display:flex;gap:16px;margin-top:10px;font-size:.78rem;color:var(--text3)}
  .post-engagement span{display:flex;align-items:center;gap:4px}

  /* Insight tabs */
  .tab-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px}
  .tab-btn{
    padding:10px 20px;border-radius:24px;border:1px solid var(--glass-border);
    background:var(--glass);color:var(--text2);cursor:pointer;font-size:.85rem;font-weight:500;
    transition:all .3s ease;backdrop-filter:blur(10px);font-family:inherit;
  }
  .tab-btn:hover{border-color:var(--glass-hover);color:var(--text);transform:translateY(-1px)}
  .tab-btn.active{border-color:rgba(71,229,255,.35);color:var(--cyan);background:rgba(71,229,255,.08);box-shadow:0 0 20px rgba(71,229,255,.1)}
  .tab-btn .count{background:var(--bg4);padding:2px 8px;border-radius:12px;font-size:.72rem;margin-left:6px;font-weight:600}
  .tab-panel{display:none}.tab-panel.active{display:block}
  .insight-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:14px}
  .insight-card{
    background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);
    padding:18px;border-left:3px solid var(--text3);transition:all .25s ease;backdrop-filter:blur(20px);
  }
  .insight-card:hover{transform:translateX(6px);border-color:var(--glass-hover);box-shadow:0 8px 30px rgba(0,0,0,.2)}
  .insight-card.cyan{border-left-color:var(--cyan)}.insight-card.orange{border-left-color:var(--orange)}
  .insight-card.green{border-left-color:var(--green)}.insight-card.red{border-left-color:var(--red)}
  .insight-card.purple{border-left-color:var(--purple)}.insight-card.blue{border-left-color:var(--blue)}
  .insight-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
  .insight-card p{color:var(--text2);font-size:.85rem;line-height:1.5}
  .prio{font-size:.68rem;padding:3px 10px;border-radius:12px;text-transform:uppercase;font-weight:700;letter-spacing:.5px}
  .prio-high{background:rgba(255,179,71,.15);color:var(--orange);border:1px solid rgba(255,179,71,.25)}
  .prio-medium{background:rgba(91,156,255,.15);color:var(--blue);border:1px solid rgba(91,156,255,.25)}
  .prio-low{background:rgba(139,143,176,.1);color:var(--text2);border:1px solid rgba(139,143,176,.2)}
  .empty{color:var(--text3);font-style:italic;padding:24px}

  /* Synapse graph */
  .graph-container{position:relative;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);overflow:hidden;backdrop-filter:blur(20px)}
  #synapse-graph{width:100%;height:650px;display:block;cursor:grab}
  #synapse-graph:active{cursor:grabbing}
  .graph-legend{display:flex;gap:16px;flex-wrap:wrap;padding:12px 20px;border-top:1px solid var(--glass-border);font-size:.8rem;color:var(--text2)}
  .legend-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:middle}
  .graph-tooltip{position:absolute;display:none;background:var(--bg2);border:1px solid var(--glass-border);border-radius:8px;padding:8px 14px;font-size:.8rem;color:var(--text);pointer-events:none;z-index:10;backdrop-filter:blur(20px);box-shadow:0 8px 30px rgba(0,0,0,.3)}

  /* Rules section */
  .rules-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px}
  .rule-card{
    background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);
    padding:16px;transition:all .25s ease;backdrop-filter:blur(20px);
  }
  .rule-card:hover{transform:translateX(4px);border-color:var(--glass-hover)}
  .rule-pattern{font-size:.75rem;color:var(--cyan);font-weight:600;margin-bottom:6px;font-family:'Fira Code',monospace}
  .rule-recommendation{color:var(--text2);font-size:.85rem}
  .rule-confidence{display:inline-flex;align-items:center;gap:6px;margin-top:8px;font-size:.75rem;color:var(--text3)}
  .confidence-bar{width:60px;height:4px;border-radius:2px;background:var(--bg4);overflow:hidden}
  .confidence-fill{height:100%;border-radius:2px;background:var(--green)}

  /* Footer */
  footer{text-align:center;padding:40px 0;border-top:1px solid var(--glass-border)}
  footer p{color:var(--text3);font-size:.8rem}
  footer code{background:var(--glass);padding:3px 10px;border-radius:6px;font-size:.78rem;border:1px solid var(--glass-border)}

  /* Responsive */
  @media(max-width:600px){.stats-grid{grid-template-columns:1fr 1fr}.insight-grid{grid-template-columns:1fr}.post-list{grid-template-columns:1fr}.logo h1{font-size:2rem}}
</style>
</head>
<body>

<canvas id="neural-bg"></canvas>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<div class="container">
  <header class="reveal">
    <div class="logo">
      <div class="logo-icon">&#128227;</div>
      <h1>Marketing Brain</h1>
    </div>
    <p class="tagline">Self-Learning Marketing Intelligence</p>
    <div class="activity">
      <span class="activity-dot"></span>
      <span class="activity-text">Marketing Intelligence</span>
      <div class="activity-bar"><div class="activity-fill" style="width:0%" data-target="{{ACTIVITY}}"></div></div>
      <span class="activity-text" style="color:var(--cyan);font-weight:700">{{ACTIVITY}}%</span>
    </div>
  </header>

  <nav class="reveal reveal-delay-1">
    <a href="#stats">Stats</a>
    <a href="#ecosystem">Ecosystem</a>
    <a href="#platforms">Platforms</a>
    <a href="#top-posts">Top Posts</a>
    <a href="#network">&#128300; Network</a>
    <a href="#rules">Rules</a>
    <a href="#research" class="research">&#128161; Research</a>
  </nav>

  <section id="stats" class="reveal reveal-delay-2">
    <div class="section-title"><div class="icon" style="background:rgba(91,156,255,.1)">&#128202;</div> Marketing Status</div>
    <div class="stats-grid">
      <div class="stat-card blue"><div class="stat-number">{{POSTS}}</div><div class="stat-label">Posts</div></div>
      <div class="stat-card purple"><div class="stat-number">{{CAMPAIGNS}}</div><div class="stat-label">Campaigns</div></div>
      <div class="stat-card cyan"><div class="stat-number">{{STRATEGIES}}</div><div class="stat-label">Strategies</div></div>
      <div class="stat-card orange"><div class="stat-number">{{RULES}}</div><div class="stat-label">Rules</div></div>
      <div class="stat-card green"><div class="stat-number">{{TEMPLATES}}</div><div class="stat-label">Templates</div></div>
      <div class="stat-card red"><div class="stat-number">{{SYNAPSES}}</div><div class="stat-label">Synapses</div></div>
    </div>
  </section>

  <section id="ecosystem" class="reveal reveal-delay-3">
    <div class="section-title"><div class="icon" style="background:rgba(61,255,160,.1)">&#127760;</div> Ecosystem Peers</div>
    <div class="stats-grid">{{ECOSYSTEM_PEERS}}</div>
  </section>

  <section id="platforms" class="reveal reveal-delay-3">
    <div class="section-title"><div class="icon" style="background:rgba(180,122,255,.1)">&#127760;</div> Platform Distribution</div>
    <div class="platform-chart">{{PLATFORM_CHART}}</div>
  </section>

  <section id="top-posts" class="reveal reveal-delay-4">
    <div class="section-title"><div class="icon" style="background:rgba(61,255,160,.1)">&#128293;</div> Top Performing Posts</div>
    <div class="post-list">{{TOP_POSTS}}</div>
  </section>

  <section id="network" class="reveal reveal-delay-4">
    <div class="section-title"><div class="icon" style="background:rgba(71,229,255,.1)">&#128300;</div> Synapse Network</div>
    <div class="graph-container">
      <canvas id="synapse-graph"></canvas>
      <div class="graph-legend">
        <span><span class="legend-dot" style="background:#5b9cff"></span> post</span>
        <span><span class="legend-dot" style="background:#b47aff"></span> campaign</span>
        <span><span class="legend-dot" style="background:#3dffa0"></span> strategy</span>
        <span><span class="legend-dot" style="background:#ffb347"></span> template</span>
        <span><span class="legend-dot" style="background:#ff5577"></span> rule</span>
        <span><span class="legend-dot" style="background:#47e5ff"></span> insight</span>
        <span style="margin-left:auto;color:var(--text3);font-size:.72rem">edges: belongs_to / similar_to / improves / generated_from</span>
      </div>
      <div id="graph-tooltip" class="graph-tooltip"></div>
    </div>
  </section>

  <section id="rules" class="reveal reveal-delay-5">
    <div class="section-title"><div class="icon" style="background:rgba(255,179,71,.1)">&#128207;</div> Learned Rules</div>
    <div class="rules-list">{{RULES_LIST}}</div>
  </section>

  <section id="research" class="reveal reveal-delay-5">
    <div class="section-title"><div class="icon" style="background:rgba(71,229,255,.1)">&#128300;</div> Research Insights</div>
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="trends">&#128200; Trends <span class="count">{{TRENDS_COUNT}}</span></button>
      <button class="tab-btn" data-tab="gaps">&#9888;&#65039; Gaps <span class="count">{{GAPS_COUNT}}</span></button>
      <button class="tab-btn" data-tab="synergies">&#9889; Synergies <span class="count">{{SYNERGIES_COUNT}}</span></button>
      <button class="tab-btn" data-tab="templates">&#127912; Templates <span class="count">{{TEMPLATES_COUNT}}</span></button>
      <button class="tab-btn" data-tab="optimizations">&#128161; Optimizations <span class="count">{{OPTIMIZATIONS_COUNT}}</span></button>
    </div>
    <div class="tab-panel active" id="tab-trends"><div class="insight-grid">{{TRENDS}}</div></div>
    <div class="tab-panel" id="tab-gaps"><div class="insight-grid">{{GAPS}}</div></div>
    <div class="tab-panel" id="tab-synergies"><div class="insight-grid">{{SYNERGIES}}</div></div>
    <div class="tab-panel" id="tab-templates"><div class="insight-grid">{{TEMPLATES_INSIGHTS}}</div></div>
    <div class="tab-panel" id="tab-optimizations"><div class="insight-grid">{{OPTIMIZATIONS}}</div></div>
  </section>

  <footer class="reveal reveal-delay-5">
    <p>Marketing Brain v{{VERSION}} &mdash; <code>marketing dashboard</code></p>
  </footer>
</div>

<script>
// --- Neural Network Canvas ---
(function(){
  const canvas = document.getElementById('neural-bg');
  const ctx = canvas.getContext('2d');
  let W, H, nodes = [], mouse = {x:-1000,y:-1000};

  function resize(){
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);
  document.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

  const NODE_COUNT = Math.min(80, Math.floor(window.innerWidth / 18));
  const CONNECT_DIST = 180;
  const MOUSE_DIST = 200;

  for(let i = 0; i < NODE_COUNT; i++){
    nodes.push({
      x: Math.random() * W,
      y: Math.random() * H,
      vx: (Math.random() - 0.5) * 0.4,
      vy: (Math.random() - 0.5) * 0.4,
      r: Math.random() * 2 + 1,
      pulse: Math.random() * Math.PI * 2,
    });
  }

  function draw(){
    ctx.clearRect(0, 0, W, H);

    for(let i = 0; i < nodes.length; i++){
      for(let j = i + 1; j < nodes.length; j++){
        const dx = nodes[i].x - nodes[j].x;
        const dy = nodes[i].y - nodes[j].y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < CONNECT_DIST){
          const alpha = (1 - dist / CONNECT_DIST) * 0.15;
          ctx.strokeStyle = 'rgba(91,156,255,' + alpha + ')';
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(nodes[i].x, nodes[i].y);
          ctx.lineTo(nodes[j].x, nodes[j].y);
          ctx.stroke();
        }
      }

      const mdx = nodes[i].x - mouse.x;
      const mdy = nodes[i].y - mouse.y;
      const mDist = Math.sqrt(mdx*mdx + mdy*mdy);
      if(mDist < MOUSE_DIST){
        const alpha = (1 - mDist / MOUSE_DIST) * 0.4;
        ctx.strokeStyle = 'rgba(180,122,255,' + alpha + ')';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(nodes[i].x, nodes[i].y);
        ctx.lineTo(mouse.x, mouse.y);
        ctx.stroke();
      }
    }

    const time = Date.now() * 0.001;
    for(const n of nodes){
      const glow = 0.4 + Math.sin(time * 1.5 + n.pulse) * 0.3;
      ctx.fillStyle = 'rgba(91,156,255,' + glow + ')';
      ctx.beginPath();
      ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
      ctx.fill();

      n.x += n.vx;
      n.y += n.vy;
      if(n.x < 0 || n.x > W) n.vx *= -1;
      if(n.y < 0 || n.y > H) n.vy *= -1;
    }

    requestAnimationFrame(draw);
  }
  draw();
})();

// --- Reveal on scroll ---
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); });
}, {threshold: 0.1});
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

// --- Tab switching ---
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});

// --- Animate stat numbers ---
const numObserver = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if(!e.isIntersecting) return;
    const el = e.target;
    if(el.dataset.animated) return;
    el.dataset.animated = '1';
    const target = parseInt(el.textContent.replace(/\D/g,''), 10);
    if(isNaN(target) || target === 0) return;
    const duration = 1200;
    const start = performance.now();
    function tick(now){
      const t = Math.min((now - start) / duration, 1);
      const ease = 1 - Math.pow(1 - t, 3);
      el.textContent = Math.round(target * ease).toLocaleString();
      if(t < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  });
}, {threshold: 0.5});
document.querySelectorAll('.stat-number').forEach(el => numObserver.observe(el));

// --- Animate platform bars ---
setTimeout(() => {
  document.querySelectorAll('.platform-bar').forEach(bar => {
    bar.style.width = bar.dataset.width + '%';
  });
}, 300);

// --- Activity bar ---
setTimeout(() => {
  document.querySelectorAll('.activity-fill').forEach(el => {
    el.style.width = el.dataset.target + '%';
  });
}, 500);

// --- Confidence bars ---
setTimeout(() => {
  document.querySelectorAll('.confidence-fill').forEach(el => {
    el.style.width = el.dataset.width + '%';
  });
}, 600);

// --- Synapse Force-Directed Graph ---
(function(){
  const edges = {{GRAPH_EDGES}};
  const canvas = document.getElementById('synapse-graph');
  if (!canvas || !edges.length) return;
  const ctx = canvas.getContext('2d');
  const container = canvas.parentElement;
  let W, H, dpr;
  let frame = 0;

  const NODE_COLORS = {
    post: '#5b9cff', campaign: '#b47aff', strategy: '#3dffa0',
    template: '#ffb347', rule: '#ff5577', insight: '#47e5ff', audience: '#b47aff'
  };
  const EDGE_COLORS = {
    belongs_to: ['#b47aff','#5b9cff'], similar_to: ['#5b9cff','#47e5ff'],
    improves: ['#3dffa0','#5bff8a'], generated_from: ['#ffb347','#ff5577'],
    prevents: ['#ff5577','#ff8866'], recommends: ['#3dffa0','#47e5ff'],
    cross_promotes: ['#b47aff','#ffb347'], informs: ['#47e5ff','#5b9cff'],
    engages_with: ['#ffb347','#3dffa0'], co_occurs: ['#5b9cff','#47e5ff']
  };
  const DEFAULT_COLOR = '#47e5ff';

  const nodeMap = new Map();
  const graphEdges = [];
  for (const e of edges) {
    if (!nodeMap.has(e.s)) nodeMap.set(e.s, { id: e.s, type: e.s.split(':')[0], x: 0, y: 0, vx: 0, vy: 0, connections: 0 });
    if (!nodeMap.has(e.t)) nodeMap.set(e.t, { id: e.t, type: e.t.split(':')[0], x: 0, y: 0, vx: 0, vy: 0, connections: 0 });
    nodeMap.get(e.s).connections++;
    nodeMap.get(e.t).connections++;
    graphEdges.push({ source: nodeMap.get(e.s), target: nodeMap.get(e.t), type: e.type, weight: e.w });
  }
  const nodes = [...nodeMap.values()];

  function resize() {
    dpr = window.devicePixelRatio || 1;
    W = container.clientWidth;
    H = 650;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resize();
  window.addEventListener('resize', resize);

  const typeGroups = {};
  for (const n of nodes) {
    if (!typeGroups[n.type]) typeGroups[n.type] = [];
    typeGroups[n.type].push(n);
  }
  const types = Object.keys(typeGroups);
  types.forEach((t, i) => {
    const angle = (i / types.length) * Math.PI * 2;
    const cx = W/2 + Math.cos(angle) * W * 0.2;
    const cy = H/2 + Math.sin(angle) * H * 0.2;
    for (const n of typeGroups[t]) {
      n.x = cx + (Math.random() - 0.5) * W * 0.25;
      n.y = cy + (Math.random() - 0.5) * H * 0.25;
    }
  });

  const REPULSION = 4000;
  const ATTRACTION = 0.006;
  const DAMPING = 0.88;
  const CENTER_GRAVITY = 0.0015;
  let hovered = null;
  let dragging = null;
  let dragOff = {x:0,y:0};

  function simulate() {
    for (let i = 0; i < nodes.length; i++) {
      for (let j = i + 1; j < nodes.length; j++) {
        let dx = nodes[i].x - nodes[j].x;
        let dy = nodes[i].y - nodes[j].y;
        let dist = Math.sqrt(dx*dx + dy*dy) || 1;
        let force = REPULSION / (dist * dist);
        let fx = (dx / dist) * force;
        let fy = (dy / dist) * force;
        nodes[i].vx += fx; nodes[i].vy += fy;
        nodes[j].vx -= fx; nodes[j].vy -= fy;
      }
    }
    for (const e of graphEdges) {
      let dx = e.target.x - e.source.x;
      let dy = e.target.y - e.source.y;
      let dist = Math.sqrt(dx*dx + dy*dy) || 1;
      let force = (dist - 120) * ATTRACTION * e.weight;
      let fx = (dx / dist) * force;
      let fy = (dy / dist) * force;
      e.source.vx += fx; e.source.vy += fy;
      e.target.vx -= fx; e.target.vy -= fy;
    }
    for (const n of nodes) {
      n.vx += (W/2 - n.x) * CENTER_GRAVITY;
      n.vy += (H/2 - n.y) * CENTER_GRAVITY;
    }
    for (const n of nodes) {
      if (n === dragging) continue;
      n.vx *= DAMPING; n.vy *= DAMPING;
      n.x += n.vx; n.y += n.vy;
      n.x = Math.max(30, Math.min(W - 30, n.x));
      n.y = Math.max(30, Math.min(H - 30, n.y));
    }
  }

  function getNodeRadius(n) {
    return Math.min(20, 4 + Math.sqrt(n.connections) * 3.5);
  }

  function draw() {
    frame++;
    ctx.clearRect(0, 0, W, H);

    for (const e of graphEdges) {
      const alpha = 0.1 + e.weight * 0.4;
      const colors = EDGE_COLORS[e.type] || ['#5b9cff','#47e5ff'];
      const grad = ctx.createLinearGradient(e.source.x, e.source.y, e.target.x, e.target.y);
      grad.addColorStop(0, colors[0] + Math.round(Math.min(0.7,alpha)*255).toString(16).padStart(2,'0'));
      grad.addColorStop(1, colors[1] + Math.round(Math.min(0.7,alpha)*255).toString(16).padStart(2,'0'));
      ctx.strokeStyle = grad;
      ctx.lineWidth = 0.5 + e.weight * 2.5;
      ctx.beginPath();
      ctx.moveTo(e.source.x, e.source.y);
      ctx.lineTo(e.target.x, e.target.y);
      ctx.stroke();
    }

    for (const n of nodes) {
      const r = getNodeRadius(n);
      const color = NODE_COLORS[n.type] || DEFAULT_COLOR;
      const isHover = n === hovered || n === dragging;
      const isHub = n.connections >= 5;

      const glowSize = isHover ? 30 : (isHub ? 15 + Math.sin(frame * 0.03 + n.x) * 5 : 8);
      ctx.shadowColor = color;
      ctx.shadowBlur = glowSize;

      if (isHub || isHover) {
        const pulseR = r + 3 + (isHub ? Math.sin(frame * 0.04 + n.y) * 2 : 0);
        ctx.strokeStyle = color;
        ctx.globalAlpha = isHover ? 0.6 : 0.25;
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(n.x, n.y, pulseR, 0, Math.PI * 2);
        ctx.stroke();
      }

      ctx.globalAlpha = isHover ? 1 : 0.85;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(n.x, n.y, r, 0, Math.PI * 2);
      ctx.fill();

      ctx.globalAlpha = 0.3;
      ctx.fillStyle = '#ffffff';
      ctx.beginPath();
      ctx.arc(n.x - r * 0.25, n.y - r * 0.25, r * 0.4, 0, Math.PI * 2);
      ctx.fill();

      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;

      if (isHover || n.connections >= 4) {
        const label = n.id;
        ctx.fillStyle = '#e8eaf6';
        ctx.font = (isHover ? 'bold 12px' : '10px') + ' Inter, system-ui, sans-serif';
        ctx.textAlign = 'center';
        ctx.globalAlpha = isHover ? 1 : 0.7;
        ctx.fillText(isHover ? n.id : n.type, n.x, n.y - r - 8);
        ctx.globalAlpha = 1;
      }
    }
    simulate();
    requestAnimationFrame(draw);
  }
  draw();

  const tooltip = document.getElementById('graph-tooltip');
  function getNodeAt(mx, my) {
    for (let i = nodes.length - 1; i >= 0; i--) {
      const n = nodes[i], r = getNodeRadius(n);
      if (Math.hypot(mx - n.x, my - n.y) <= r + 4) return n;
    }
    return null;
  }
  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }
  canvas.addEventListener('mousemove', function(e) {
    const p = getPos(e);
    if (dragging) {
      dragging.x = p.x + dragOff.x;
      dragging.y = p.y + dragOff.y;
      dragging.vx = 0; dragging.vy = 0;
      return;
    }
    const n = getNodeAt(p.x, p.y);
    hovered = n;
    canvas.style.cursor = n ? 'pointer' : 'grab';
    if (n) {
      const conns = graphEdges.filter(e => e.source === n || e.target === n);
      const types = {};
      conns.forEach(c => { types[c.type] = (types[c.type]||0)+1; });
      const typeStr = Object.entries(types).map(([t,c]) => t+': '+c).join(', ');
      tooltip.innerHTML = '<strong>' + n.id + '</strong><br>' + conns.length + ' connections<br><span style="color:var(--text3);font-size:.75rem">' + typeStr + '</span>';
      tooltip.style.display = 'block';
      tooltip.style.left = (p.x + 15) + 'px';
      tooltip.style.top = (p.y - 10) + 'px';
    } else {
      tooltip.style.display = 'none';
    }
  });
  canvas.addEventListener('mousedown', function(e) {
    const p = getPos(e);
    const n = getNodeAt(p.x, p.y);
    if (n) {
      dragging = n;
      dragOff = { x: n.x - p.x, y: n.y - p.y };
      canvas.style.cursor = 'grabbing';
    }
  });
  canvas.addEventListener('mouseup', function() { dragging = null; });
  canvas.addEventListener('mouseleave', function() { dragging = null; hovered = null; tooltip.style.display = 'none'; });
})();
</script>
</body>
</html>
